pipeline {
  agent any

  triggers {
    githubPush() // GitHub Webhookê³¼ ì—°ê²°í•´ì„œ ìžë™ ì‹¤í–‰
  }

  stages {
    stage('Build') {
      steps {
        echo 'ðŸ”§ ë¹Œë“œ ì‹œìž‘!'
        sh './gradlew clean build'
      }
    }

    stage('Test') {
      steps {
        echo 'ðŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰!'
        sh './gradlew test'
      }
    }

    stage('Deploy') {
      steps {
        echo 'ðŸš€ ë°°í¬ ì‹œìž‘!'
        sshagent(['deploy-key']) {
          sh '''
            scp build/libs/*.jar ubuntu@my-server:/home/ubuntu/app.jar
            ssh ubuntu@my-server 'pkill -f app.jar || true && nohup java -jar /home/ubuntu/app.jar > app.log 2>&1 &'
          '''
        }
      }
    }
  }
}
